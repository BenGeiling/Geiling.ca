<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">

<!-- HEADER -->
<head>
	<!-- Set-up important tags + load css -->
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<title>Ben Geiling</title>
	<meta name="robots" content="index" />
	<meta name="author" content="Ben Geiling" />
	<link rel="stylesheet" type="text/css" href="main.css" media="screen" />

	<!-- Include JQuery -->
	<script type="text/javascript" src="scripts/jquery-2.1.4.min.js"></script>

	<!-- Include content resize script -->
	<script type="text/javascript" src="scripts/resize.js"></script>

	<!-- FOREGROUND -->
	<script>

        var stageForeground;
        var FOREGROUND;
        var offsetX, offsetY;
        var OPACITY = 0.8;
        var DRAGGING = false;

        var STARTUP = true; //Do different stuff when the page first loads
        var REPORT = false; //Debugging ON/OFF

        var displayObjects = new Array();

        var textX;
        var textY;

        function mouseMoveListener(evt) {
            //Get mouse position
            var bRect = stageForeground.getBoundingClientRect();
            var mouseX = (evt.clientX - bRect.left)*(stageForeground.width/bRect.width);
            var mouseY = (evt.clientY - bRect.top)*(stageForeground.height/bRect.height);

           // var temp = Math.abs(((mouseX-offsetX)));
            //console.log(temp);
            //container.W = container.H = temp;
            //if (temp > 1) {OPACITY = 1;} else {OPACITY = temp;}

            DRAGGING.X = DRAGGING.Xori + (mouseX-offsetX);
            DRAGGING.Y = DRAGGING.Yori + (mouseY-offsetY);

            //Make sure it everything stays within the screen
            var radius = (DRAGGING.H + DRAGGING.W) / 4;

            if ((DRAGGING.X - radius) < 0) {DRAGGING.X = radius;}
            else if ((DRAGGING.X + radius) > BODY_WIDTH) {DRAGGING.X = BODY_WIDTH - radius;}

            if ((DRAGGING.Y - radius) < 0) {DRAGGING.Y = radius;}
            else if ((DRAGGING.Y + radius) > BODY_HEIGHT) {DRAGGING.Y = BODY_HEIGHT - radius;}

            draw();

            return false;
        }

        function mouseUpListener(evt) {
            stageForeground.addEventListener("mousedown", mouseDownListener, false);
            window.removeEventListener("mouseup", mouseUpListener, false);
            if (DRAGGING) {
                DRAGGING = false;
                stageForeground.removeEventListener("mousemove", mouseMoveListener, false);
            }
        }

        //When there is a mouse click
        function mouseDownListener(evt) {

            //Get mouse position
            var bRect = stageForeground.getBoundingClientRect();
            var mouseX = (evt.clientX - bRect.left)*(stageForeground.width/bRect.width);
            var mouseY = (evt.clientY - bRect.top)*(stageForeground.height/bRect.height);

            //Check if the mouse is in a circle (work backwards through array to maintain z-index)
            for (x = (displayObjects.length - 1); x >= 0; x--) {
                var object = displayObjects[x];
                var radiusSquared = Math.pow(((object.H + object.W) / 4), 2);
                var mouseSquared = Math.pow((mouseX - object.X), 2) + Math.pow((mouseY - object.Y), 2);

                //Check if mouse X/Y are inside of the circle
                if (mouseSquared < radiusSquared) {

                        offsetX = mouseX; offsetY = mouseY;
                        object.Xori = object.X; object.Yori = object.Y;

                        DRAGGING = object;
                        stageForeground.addEventListener("mousemove", mouseMoveListener, false);

                        stageForeground.removeEventListener("mousedown", mouseDownListener, false);
                        window.addEventListener("mouseup", mouseUpListener, false);

                        return true;
                }

        }
            //code below prevents the mouse down from having an effect on the main browser window:
            if (evt.preventDefault) {
                evt.preventDefault();
            } //standard
            else if (evt.returnValue) {
                evt.returnValue = false;
            } //older IE

            return false;
        }



        //Called by resize.js when the page needs to be loaded
		function pageLoad() {

            //When the page first loads do different stuff, housekeeping mostly
            if (STARTUP) {
                //Setup the canvas variables
                stageForeground = document.getElementById('stageForeground');
                FOREGROUND = stageForeground.getContext('2d');

                //Preload images here!

                //Add a listener for mousedown
                stageForeground.addEventListener("mousedown", mouseDownListener, false);
                STARTUP = false;
            }



			//Create a min. relative stage size (looks better smaller on bigger screens)
			var MAX_SIZE = 500;
            var SCALE_FACTOR = 0.6; //Scale everything to be 80% min. size
            var stageW = MAX_SIZE; //Try to keep the size at max. size as long as possible

            if (MAX_SIZE >= SCALE) {
                stageW = SCALE;
            }

			//Set size of constant DIVs
            $("#stageForeground").prop('width', BODY_WIDTH)
            $("#stageForeground").prop('height', BODY_HEIGHT)

            //Setup containers for display
            displayObjects = []; //Empty display array

            var newObject = {
                X: Math.round((BODY_WIDTH/2)), //current X position
                Y: Math.round((BODY_HEIGHT/2)), //current Y position
                Xold: Math.round((BODY_WIDTH/2)), //last X position
                Yold: Math.round((BODY_HEIGHT/2)), //last Y position
                Xori: Math.round((BODY_WIDTH/2)), //original X position
                Yori: Math.round((BODY_HEIGHT/2)), //original Y position
                H: Math.round((SCALE*SCALE_FACTOR)), //Height
                W: Math.round((SCALE*SCALE_FACTOR)), //Width
                image: "images/circle3.svg", //image location
                text: {
                    X: 0,
                    Y: 0,
                    H: 0,
                    W: 0,
                    image: ""
                }
            }; displayObjects.push(newObject);

            var newObject = {
                X: Math.round((BODY_WIDTH/2)), //current X position
                Y: Math.round((BODY_HEIGHT/2)), //current Y position
                Xold: Math.round((BODY_WIDTH/2)), //last X position
                Yold: Math.round((BODY_HEIGHT/2)), //last Y position
                Xori: Math.round((BODY_WIDTH/2)), //original X position
                Yori: Math.round((BODY_HEIGHT/2)), //original Y position
                H: Math.round((SCALE*SCALE_FACTOR)), //Height
                W: Math.round((SCALE*SCALE_FACTOR)), //Width
                image: "images/circle2.svg", //image location
                text: {
                    X: 0,
                    Y: 0,
                    H: 0,
                    W: 0,
                    image: ""
                }
            }; displayObjects.push(newObject);

            var newObject = {
                X: Math.round((BODY_WIDTH/2)), //current X position
                Y: Math.round((BODY_HEIGHT/2)), //current Y position
                Xold: Math.round((BODY_WIDTH/2)), //last X position
                Yold: Math.round((BODY_HEIGHT/2)), //last Y position
                Xori: Math.round((BODY_WIDTH/2)), //original X position
                Yori: Math.round((BODY_HEIGHT/2)), //original Y position
                H: Math.round((SCALE*SCALE_FACTOR)), //Height
                W: Math.round((SCALE*SCALE_FACTOR)), //Width
                image: "images/circle1.svg", //image location
                text: {
                    X: 0,
                    Y: 0,
                    H: 0,
                    W: 0,
                    image: "images/textA.svg"
                }
            }; displayObjects.push(newObject);

            draw();

			//Handle all the icons
			//var iconID = new Array();
			//iconID = ["google", "facebook", "twitter", "github", "keybase", "links", "instagram", "publications"];
			/*/Loop through each icon ID
			for (var x = 0; x < iconID.length; x++) {

				//Sort out common icon attributes
				$("#"+iconID[x]).height(iconSize); $("#"+iconID[x]).width(iconSize);
				//$("#"+iconID[x]).css("float", "left");

				//Add Onclick function
				var onclickLocation;
				if (iconID[x] === "google") {
					onclickLocation = "https://www.plus.google.com/106269819982694676557/posts/p/pub";
				} else if (iconID[x] === "facebook") {
					onclickLocation = "https://www.facebook.com/ben.geiling";
				} else if (iconID[x] === "twitter") {
					onclickLocation = "https://www.twitter.com/BenGeiling";
				} else if (iconID[x] === "github") {
					onclickLocation = "https://www.github.com/BenGeiling";
				} else if (iconID[x] === "keybase") {
					onclickLocation = "https://www.keybase.io/bengeiling/";
				} else if (iconID[x] === "instagram") {
					onclickLocation = "https://www.instagram.com/bengeiling/";
				} else if (iconID[x] === "publications") {
					onclickLocation = "https://scholar.google.com/citations?user=1diKV9kAAAAJ&hl=en";
				} else if (iconID[x] === "links") {
					onclickLocation = "http://www.open-gmo.org/";
				}

				$("#"+iconID[x]).attr('onclick', "window.location='"+onclickLocation+"';");

				//Check if icon is on the end of a line or not
				if (x === (iconNumber-1) || x === ((iconNumber*2)-1)) {
					$("#"+iconID[x]).css("margin-right", 0); //End icons don't get a margin
				} else {$("#"+iconID[x]).css("margin-right", iconSpace);}
			}*/
		}

/******************************************************************
*********************     Draw Everything     *********************
******************************************************************/
function draw() {
    var globalSpace = Math.ceil(SCALE/100);

    //Clear canvas first before drawing anything new
    FOREGROUND.clearRect(0, 0, BODY_WIDTH, BODY_HEIGHT);

    //Loop through all the objects that need to be drawn to the screen
    displayObjects.forEach(function(object) {
        reportLog(object); //Report object to log
        reportLog("X,Y,W,H - "+object.X+","+object.Y+","+object.W+","+object.H); //Report coords to log

        FOREGROUND.globalAlpha = OPACITY;

        //Draw the background circle from X/Y center point
        var img_circle = new Image(); img_circle.src = object.image;
        FOREGROUND.drawImage(img_circle, object.X-(object.W/2), object.Y-(object.H/2), object.W, object.H);

        //Update old values
        object.Xold = object.X;
        object.Yold = object.Y;

        FOREGROUND.globalAlpha = OPACITY/1.5;

        var X1, X2, Y1, Y2, W, H;

        //Draw the text in the background
        if (object.text.image) {
            W = (object.W*0.8);
            H = W/2.54;
            X1 = object.X-(W/2);
            X2 = object.X-(W/2);
            Y1 = object.Y-(H/2)-(globalSpace*5);
            Y2 = object.Y-(H/2)-(globalSpace*5);

            var img_text = new Image(); img_text.src = object.text.image;
            FOREGROUND.drawImage(img_text, X1, Y1, W, H);
        }

        //Draw top line
        var lineWidth = Math.ceil(globalSpace/3);
        X1 = X1;
        Y1 += H+(globalSpace*2)
        X2 += W;
        Y2 += H+(globalSpace*2);

        FOREGROUND.beginPath();
        FOREGROUND.moveTo(X1, Y1);
        FOREGROUND.lineTo(X2, Y2);
        FOREGROUND.lineWidth = lineWidth;
        FOREGROUND.strokeStyle = '#FFFFFF';
        FOREGROUND.stroke();
        FOREGROUND.closePath();

        //Draw icons
        var iconNumber = 8;
        H = (W/iconNumber)-(globalSpace*((iconNumber-1)/iconNumber));
        W = (W/iconNumber)-(globalSpace*((iconNumber-1)/iconNumber));
        Y1 += lineWidth + (globalSpace/2);
        Y2 += lineWidth + (globalSpace/2);

        var image = new Image(); image.src = "images/facebookA.svg";
        FOREGROUND.drawImage(image, X1, Y1, W, H);

        //Draw bottom line
        var lineWidth = Math.ceil(globalSpace/3);
        X1 = X1;
        Y1 += H+lineWidth+(globalSpace/2);
        X2 = X2;
        Y2 += H+lineWidth+(globalSpace/2);

        FOREGROUND.beginPath();
        FOREGROUND.moveTo(X1, Y1);
        FOREGROUND.lineTo(X2, Y2);
        FOREGROUND.lineWidth = lineWidth;
        FOREGROUND.strokeStyle = '#FFFFFF';
        FOREGROUND.stroke();
        FOREGROUND.closePath();

        //Draw drag text
        W = (object.W*0.6);
        H = W/3;
        X1 = object.X-(W/2);
        Y1 = Y1+(globalSpace);

        var image = new Image(); image.src = "images/drag.svg";
        FOREGROUND.drawImage(image, X1, Y1, W, H);

    });
}

//Report to console function set REPORT = true for debugging
function reportLog(text) {
    if (REPORT) {console.log(text);}
    return false;
}

</script>
</head>

<!-- BODY -->
<body>
    <?php include_once("analyticstracking.php") ?>
    <div id="preload"></div>
    <canvas id="stageForeground"></canvas>
	<div id="background">
        <div id="backer">

                <div id="text" onclick="window.location='mailto:ben@geiling.ca';" title="email me!"></div>

                <div class="line"></div>
                <div id="icons">
                    <div id="google" title="Google+"></div>
                    <div id="facebook" title="Facebook"></div>
                    <div id="twitter" title="Twitter"></div>
                    <div id="github" title="Github"></div>
                    <div id="keybase" title="Keybase"></div>
                    <div id="links" title="Links"></div>
                    <div id="instagram" title="Instagram"></div>
                    <div id="publications" title="Publications"></div>
                </div>
                <div class="line"></div>
            <div id="drag"></div>

        </div>
    </div>
</body>
