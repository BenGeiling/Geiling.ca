<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">

<!-- HEADER -->
<head>
	<!-- Set-up important tags + load css -->
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<title>Ben Geiling</title>
	<meta name="robots" content="index" />
	<meta name="author" content="Ben Geiling" />
	<link rel="stylesheet" type="text/css" href="main.css" media="screen" />

	<!-- Include content resize script -->
	<script type="text/javascript" src="scripts/resize.js"></script>
</head>

<!-- BODY -->
<body>
   <!-- Google Analytics -->
   <?php include_once("analyticstracking.php") ?>

   <!-- Preload all the SVGs -->
   <div id="preload"></div>

   <!-- Where the magic happens -->
   <canvas id="stageForeground"></canvas>
</body>

<!-- JavaScript -->
<script>

    var stageForeground, FOREGROUND; //The foreground canvas
    var STARTUP = true; //Do different stuff when the page first loads
    var REPORT = false; //Debugging ON/OFF
    var GLOBAL_VAR = 0; //Debugging variable
    var OPACITY = 0.8; //Global oppacity value
    var DRAGGING = false; //Object being dragged (or not)
        var firstDrag = false; //Check to ensure user "gets it"
        var overlapObject = true; //Overlap check
    var HOVERING = false; //Object being hovered (or not)
    var PULSE = 0;

    var standardSize;

    var displayObjects = new Array(); //All objects drawn to the scree
    var offsetX, offsetY; //The offset of the objects from the center when dragging

    //Animation loop stuff
    var fps = 30;
    var now;
    var then = Date.now();
    var interval = 1000/fps;
    var delta;

    //Check if an object is on the screen and report corrected X/Y coords
    function onScreen(object) {
        var radius = (object.H + object.W) / 4;
        var X, Y;

        if ((object.X - radius) < 0) {X = radius + 3;}
        else if ((object.X + radius) > BODY_WIDTH) {X = BODY_WIDTH - radius - 3;}

        if ((object.Y - radius) < 0) {Y = radius + 3;}
        else if ((object.Y + radius) > BODY_HEIGHT) {Y = BODY_HEIGHT - radius - 3;}

        return {X:X, Y:Y};
    }

        function mouseMoveListener(evt) {

            //Get location of click either mouse or touch
            if (evt.touches) {
                click = {X: evt.touches[0].pageX, Y: evt.touches[0].pageY};
            } else {
                click = {X: evt.pageX, Y: evt.pageY};
            }

            //Get mouse position
            var bRect = stageForeground.getBoundingClientRect();
            var mouseX = (click.X - bRect.left)*(stageForeground.width/bRect.width);
            var mouseY = (click.Y - bRect.top)*(stageForeground.height/bRect.height);

            //Save the last location of dragging object
            //console.log(DRAGGING);
            var lastX = DRAGGING.X;
            var lastY = DRAGGING.Y;

            //Setup X/Y coords relative to original position of object
            DRAGGING.X = DRAGGING.Xori + (mouseX-offsetX);
            DRAGGING.Y = DRAGGING.Yori + (mouseY-offsetY);

            //Make sure it everything stays within the screen
            var positionCheck = onScreen(DRAGGING);
            if (positionCheck.X) {DRAGGING.X = positionCheck.X;}
            if (positionCheck.Y) {DRAGGING.Y = positionCheck.Y;}

            //Scale circle dynamically with position
            //DRAGGING.W = DRAGGING.W - 5;
            //DRAGGING.H = DRAGGING.H - 5;

            //Check if the mouse is in a circle (work backwards through array to maintain z-index)
            HOVERING = false; document.body.style.cursor = "default";

            for (x = (displayObjects.length - 1); x >= 0; x--) {
                var object = displayObjects[x];
                var radiusSquared = Math.pow(((object.H + object.W) / 4), 2);
                var mouseSquared = Math.pow((mouseX - object.X), 2) + Math.pow((mouseY - object.Y), 2);

                //Check if mouse X/Y are inside of the circle
                if ((mouseSquared < radiusSquared)) {
                    //Check for mouse in icon
                    if (object.icon) {
                        var radiusSquared = Math.pow(((object.H*object.icon.size + object.W*object.icon.size) / 4), 2);
                        if ((mouseSquared < radiusSquared)) {
                            document.body.style.cursor = "pointer";
                            HOVERING = object;
                        }
                    }
                        break; //Ends the loop on the highest z-index object in the stack that the mouse is over
                }
            }

            //Snap Circles to background
            var backgroundObject = [];
            var newObject = {
                X: Math.round((BODY_WIDTH/2)-(standardSize*1.185)),
                Y: Math.round((BODY_HEIGHT/2))
            }; backgroundObject.push(newObject); //Left
            var newObject = {
                X: Math.round((BODY_WIDTH/2)+(standardSize*1.185)),
                Y: Math.round((BODY_HEIGHT/2))
            }; backgroundObject.push(newObject); //Right
            var newObject = {
                X: Math.round((BODY_WIDTH/2)),
                Y: Math.round((BODY_HEIGHT/2))
            }; backgroundObject.push(newObject); //Center

            for (x = 0; x < backgroundObject.length; x++) {
                //Setup collision check variables
                var minDistance = Math.pow((DRAGGING.H/10), 2);
                var xVector = Math.pow((DRAGGING.X-backgroundObject[x].X), 2);
                var yVector = Math.pow((DRAGGING.Y-backgroundObject[x].Y), 2);
                var currentDistance = (xVector + yVector);

                //If there is a collision
                if (currentDistance < minDistance) {
                    //Center the circle to left
                    DRAGGING.X = backgroundObject[x].X;
                    DRAGGING.Y = backgroundObject[x].Y;
                }
            }

            /*/UHH???
            displayObjects.forEach(function(object) {
                if (DRAGGING.name !== object.name) {
                if (DRAGGING.name === "page2" && object.name === "page1") {

                    //Setup collision check variables
                    var minDistance = Math.pow((DRAGGING.H/2) + (object.H/2), 2);
                    var xVector = Math.pow((DRAGGING.X-object.X), 2);
                    var yVector = Math.pow((DRAGGING.Y-object.Y), 2);
                    var currentDistance = (xVector + yVector);

                    //If there is a collision
                    if (currentDistance < minDistance) {



                        //Update objects X coord.
                        var updatedDistance = Math.sqrt(minDistance)-Math.sqrt(currentDistance);

                        //Right or left check
                        if (DRAGGING.X > object.X) {
                            object.X = object.X - updatedDistance;
                        } else {
                            object.X = object.X + updatedDistance;
                        }

                        //Make sure it everything stays within the screen
                        var positionCheck = onScreen(object);
                        if (positionCheck.X) {object.X = positionCheck.X;}
                        if (positionCheck.Y) {object.Y = positionCheck.Y;}

                        //Reset draging object position, probably should do this earlier
                        if (positionCheck.X || positionCheck.Y) {
                            DRAGGING.X = lastX; DRAGGING.Y = lastY;
                        }


                        //Change size of object when it's up against an edge
                       // if (positionCheck.X || positionCheck.X) {


                            //var updatedRadius = Math.sqrt(currentDistance)-(DRAGGING.W/2);
                            //if (updatedRadius > 50) {

                               // object.H = updatedRadius*2;
                              //  object.W = updatedRadius*2;
                            //}
                       // }

                    }
                }
                }
            });*/

            draw();

            return false;

        }

        function mouseUpListener(evt) {
            stageForeground.addEventListener("mousedown", mouseDownListener, false);
            window.removeEventListener("mouseup", mouseUpListener, false);
            window.removeEventListener("touchend", mouseUpListener, false);
            if (DRAGGING) {
                DRAGGING = false;
                //stageForeground.removeEventListener("mousemove", mouseMoveListener, false);
            }
        }

        //When there is a mouse click or touch event
        function mouseDownListener(evt) {

            //Get location of either mouse or touch
            if (evt.touches) {
                click = {X: evt.touches[0].pageX, Y: evt.touches[0].pageY};
            } else {
                click = {X: evt.pageX, Y: evt.pageY};
            }

            //Get mouse position
            var bRect = stageForeground.getBoundingClientRect();
            var mouseX = (click.X - bRect.left)*(stageForeground.width/bRect.width);
            var mouseY = (click.Y - bRect.top)*(stageForeground.height/bRect.height);

            //Check if the mouse is in a circle (work backwards through array to maintain z-index)
            for (x = (displayObjects.length - 1); x >= 0; x--) {
                var object = displayObjects[x];
                var radiusSquared = Math.pow(((object.H + object.W) / 4), 2);
                var mouseSquared = Math.pow((mouseX - object.X), 2) + Math.pow((mouseY - object.Y), 2);

                //Check if mouse X/Y are inside of the circle
                if ((mouseSquared < radiusSquared) && object.draggable === true) {

                        offsetX = mouseX; offsetY = mouseY;
                        object.Xori = object.X; object.Yori = object.Y;

                        DRAGGING = object; if (!firstDrag) {firstDrag = true;}

                        stageForeground.removeEventListener("mousedown", mouseDownListener, false);
                        stageForeground.removeEventListener("touchdown", mouseDownListener, false);

                        window.addEventListener("mouseup", mouseUpListener, false);
                        window.addEventListener("touchend", mouseUpListener, false);

                        break;
                }
            }

            //code below prevents the mouse down from having an effect on the main browser window:
            if (evt.preventDefault) {
                evt.preventDefault();
            } //standard
            else if (evt.returnValue) {
                evt.returnValue = false;
            } //older IE

            //Check if hovering on icon
            if (HOVERING) {
                if (HOVERING.icon.name === "github") {
                    window.open('https://www.github.com/BenGeiling', '_blank');
                    HOVERING = false; DRAGGING = false;
                }
            }

            return false;
        }



        //Called by resize.js when the page needs to be loaded
		function pageLoad() {

            //When the page first loads do different stuff, housekeeping mostly
            if (STARTUP) {
                //Setup the canvas variables
                stageForeground = document.getElementById('stageForeground');
                FOREGROUND = stageForeground.getContext('2d');

                //Preload images here!

                //Add a listener for mousedown
                stageForeground.addEventListener("mousedown", mouseDownListener, false);
                stageForeground.addEventListener("touchstart", mouseDownListener, false);
                STARTUP = false;
            }



			//Create a min. relative stage size (looks better smaller on bigger screens)
			var MAX_SIZE = 500;
            var SCALE_FACTOR = 0.58; //Scale everything to be 80% min. size
            var stageW = MAX_SIZE; //Try to keep the size at max. size as long as possible

            if (MAX_SIZE >= SCALE) {
                stageW = SCALE;
            }

			//Set size of constant DIVs
            stageForeground.width = BODY_WIDTH;
            stageForeground.height = BODY_HEIGHT;

            var centerX = Math.round((BODY_WIDTH/2));
            var centerY = Math.round((BODY_HEIGHT/2));
            standardSize = Math.round((SCALE*SCALE_FACTOR));

            //Setup containers for display
            displayObjects = []; //Empty display array

            var newObject = {
                name: "background",
                X: centerX, //current X position
                Y: centerY, //current Y position
                Xold: centerX, //last X position
                Yold: centerY, //last Y position
                Xori: centerX, //original X position
                Yori: centerY, //original Y position
                H: standardSize*3.5, //Height
                W: standardSize*3.5, //Width
                image: "images/circle0.svg", //image location
                alpha: 1, //opacity
                draggable: false
            }; displayObjects.push(newObject);

           /* var newObject = {
                name: "background",
                X: centerX-standardSize*1.1, //current X position
                Y: centerY, //current Y position
                Xold: centerX-standardSize*1.1, //last X position
                Yold: centerY, //last Y position
                Xori: centerX-standardSize*1.1, //original X position
                Yori: centerY, //original Y position
                H: standardSize*0.8, //Height
                W: standardSize*0.8, //Width
                image: "images/circle_cut.svg", //image location
                alpha: 1, //opacity
                draggable: false
            }; displayObjects.push(newObject);

            var newObject = {
                name: "background",
                X: centerX+standardSize*1.1, //current X position
                Y: centerY, //current Y position
                Xold: centerX+standardSize*1.1, //last X position
                Yold: centerY, //last Y position
                Xori: centerX+standardSize*1.1, //original X position
                Yori: centerY, //original Y position
                H: standardSize*0.8, //Height
                W: standardSize*0.8, //Width
                image: "images/circle_cut.svg", //image location
                alpha: 1, //opacity
                draggable: false
            }; displayObjects.push(newObject);*/

           var newObject = {
                name: "circle3",
                X: centerX, //current X position
                Y: centerY, //current Y position
                Xold: centerX, //last X position
                Yold: centerY, //last Y position
                Xori: centerX, //original X position
                Yori: centerY, //original Y position
                H: standardSize, //Height
                W: standardSize, //Width
                background1: "images/circle3a.svg", //image location
                background2: "images/circle3b.svg", //image location
                draggable: true
            }; displayObjects.push(newObject);

            var newObject = {
                name: "circle2",
                X: centerX, //current X position
                Y: centerY, //current Y position
                Xold: centerX, //last X position
                Yold: centerY, //last Y position
                Xori: centerX, //original X position
                Yori: centerY, //original Y position
                H: standardSize, //Height
                W: standardSize, //Width
                image: "images/circle2a.svg", //image location
                background1: "images/circle2b.svg", //Background location
                background2: "images/circle2c.svg", //Background location
                icon: {
                    name: "github",
                    image1: "images/githubA.svg", //image location
                    image2: "images/githubB.svg", //image location
                    size: 0.3 //Icon size
                },
                size: 1, //Size
                draggable: true
            }; displayObjects.push(newObject);

            var newObject = {
                name: "circle1",
                X: centerX, //current X position
                Y: centerY, //current Y position
                Xold: centerX, //last X position
                Yold: centerY, //last Y position
                Xori: centerX, //original X position
                Yori: centerY, //original Y position
                H: standardSize, //Height
                W: standardSize, //Width
                image: "images/circle1a.svg", //Image location
                background1: "images/circle1b.svg", //Background location
                background2: "images/circle1c.svg", //Background location
                size: 1, //Size
                draggable: true
            }; displayObjects.push(newObject);

            // Start things off
            stageForeground.addEventListener("mousemove", mouseMoveListener, false);
            stageForeground.addEventListener("touchmove", mouseMoveListener, false);
            requestAnimationFrame(mainLoop);

			/*/Loop through each icon ID
				//Add Onclick function
				var onclickLocation;
				if (iconID[x] === "google") {
					onclickLocation = "https://www.plus.google.com/106269819982694676557/posts/p/pub";
				} else if (iconID[x] === "facebook") {
					onclickLocation = "https://www.facebook.com/ben.geiling";
				} else if (iconID[x] === "twitter") {
					onclickLocation = "https://www.twitter.com/BenGeiling";
				} else if (iconID[x] === "github") {
					onclickLocation = "https://www.github.com/BenGeiling";
				} else if (iconID[x] === "keybase") {
					onclickLocation = "https://www.keybase.io/bengeiling/";
				} else if (iconID[x] === "instagram") {
					onclickLocation = "https://www.instagram.com/bengeiling/";
				} else if (iconID[x] === "publications") {
					onclickLocation = "https://scholar.google.com/citations?user=1diKV9kAAAAJ&hl=en";
				} else if (iconID[x] === "links") {
					onclickLocation = "http://www.open-gmo.org/";
				}
			}*/
		}

/******************************************************************
*********************     Draw Everything     *********************
******************************************************************/
function draw() {
    //Rounded space distance value if needed to draw things
    var globalSpace = Math.ceil(SCALE/100);

    //Clear canvas first before drawing anything new
    FOREGROUND.clearRect(0, 0, BODY_WIDTH, BODY_HEIGHT);

    //Loop through all the objects that need to be drawn to the screen
    displayObjects.forEach(function(object) {
        //Report object to log
        //reportLog("Drawing: " + object.name);

        //Draw the background circle from X/Y center point
        if (object.name === "background") {
            FOREGROUND.globalAlpha = object.alpha;
            var image = new Image(); image.src = object.image; //object.image;
            FOREGROUND.drawImage(image, object.X-(object.W/2), object.Y-(object.H/2), object.W, object.H);
            FOREGROUND.globalAlpha = 1;
        } else if (object.name === "circle1") {
            GLOBAL_VAR += 0.2; if (GLOBAL_VAR > 360) {GLOBAL_VAR = 1;}

            //Rotate the background image
            FOREGROUND.translate(object.X, object.Y);
            FOREGROUND.rotate(Math.PI/180*GLOBAL_VAR);
            FOREGROUND.translate(-object.X, -object.Y);

            //Draw the background
            var image = new Image(); image.src = object.background2;
            FOREGROUND.drawImage(image, w(object.X-(object.W/2)), w(object.Y-(object.H/2)), w(object.W), w(object.H));

            //Undo the rotation
            FOREGROUND.translate(object.X, object.Y);
            FOREGROUND.rotate(-Math.PI/180*GLOBAL_VAR*0.70);
            FOREGROUND.translate(-object.X, -object.Y);

            //Draw the background
            var image = new Image(); image.src = object.background1;
            FOREGROUND.drawImage(image, w(object.X-(object.W/2)), w(object.Y-(object.H/2)), w(object.W), w(object.H));

            //Undo the rotation
            FOREGROUND.translate(object.X, object.Y);
            FOREGROUND.rotate(-Math.PI/180*GLOBAL_VAR*0.30);
            FOREGROUND.translate(-object.X, -object.Y);

            //Draw the circle image
            var image = new Image(); image.src = object.image;
            FOREGROUND.drawImage(image, w(object.X-(object.W*object.size*0.95/2)), w(object.Y-(object.H*object.size*0.95/2)), w(object.W*object.size*0.95), w(object.H*object.size*0.95));
        } else if (object.name === "circle2") {
            GLOBAL_VAR += 0.2; if (GLOBAL_VAR > 360) {GLOBAL_VAR = 1;}

            //Rotate the background image
            FOREGROUND.translate(object.X, object.Y);
            FOREGROUND.rotate(Math.PI/180*GLOBAL_VAR);
            FOREGROUND.translate(-object.X, -object.Y);

            //Draw the background
            var image = new Image(); image.src = object.background2;
            FOREGROUND.drawImage(image, w(object.X-(object.W/2)), w(object.Y-(object.H/2)), w(object.W), w(object.H));

            //Undo the rotation
            FOREGROUND.translate(object.X, object.Y);
            FOREGROUND.rotate(-Math.PI/180*GLOBAL_VAR*0.30);
            FOREGROUND.translate(-object.X, -object.Y);

            //Draw the background
            var image = new Image(); image.src = object.background1;
            FOREGROUND.drawImage(image, w(object.X-(object.W/2)), w(object.Y-(object.H/2)), w(object.W), w(object.H));

            //Undo the rotation
            FOREGROUND.translate(object.X, object.Y);
            FOREGROUND.rotate(-Math.PI/180*GLOBAL_VAR*0.70);
            FOREGROUND.translate(-object.X, -object.Y);

            //Draw the circle image
            var image = new Image(); image.src = object.image;
            FOREGROUND.drawImage(image, w(object.X-(object.W/2)), w(object.Y-(object.H/2)), w(object.W), w(object.H));
        } else if (object.name === "circle3") {

            //Draw the background
            var image = new Image(); image.src = object.background2;
            FOREGROUND.drawImage(image, w(object.X-(object.W/2)), w(object.Y-(object.H/2)), w(object.W), w(object.H));

            GLOBAL_VAR += 0.2; if (GLOBAL_VAR > 360) {GLOBAL_VAR = 1;}
            FOREGROUND.globalAlpha = GLOBAL_VAR/360*2;

            //Draw the background
            var image = new Image(); image.src = object.background1;
            FOREGROUND.drawImage(image, w(object.X-(object.W/2)), w(object.Y-(object.H/2)), w(object.W), w(object.H));
            FOREGROUND.globalAlpha = 1;

        }

        //Check if icons need to be drawn
        if (object.icon) {
            var image = new Image();

            //Deal with hover effect
            if (HOVERING) {image.src = object.icon.image2;}
            else {image.src = object.icon.image1;}

            FOREGROUND.drawImage(image, w(object.X-(object.W*object.size*object.icon.size/2)), w(object.Y-(object.H*object.size*object.icon.size/2)), w(object.W*object.size*object.icon.size), w(object.H*object.size*object.icon.size));
        }

        //Update old values
        object.Xold = object.X;
        object.Yold = object.Y;

if (object.name === "page3") {
        //Draw the middle circle from X/Y center point
        var img_circle = new Image(); img_circle.src = "images/link_text.svg";
        FOREGROUND.drawImage(img_circle, object.X-(object.W/6), object.Y-(object.H/6), object.W/3, object.H/3);

    var X1, X2, Y1, Y2, W, H;

            W = (object.W*0.7);
            H = W/2.54;
            X1 = object.X-((object.W*0.7)/2);
            X2 = object.X-((object.W*0.7)/2);
            Y1 = object.Y-(H/2)-(globalSpace*5);
            Y2 = object.Y-(H/2)-(globalSpace*5);

        //Draw icons
        var iconNumber = 8;
        H = (W/(iconNumber/2.5));
        W = (W/(iconNumber/2.5));
   //     Y1 += lineWidth + (globalSpace/2);
   //     Y2 += lineWidth + (globalSpace/2);

        var iconID = new Array();
		iconID = ["google", "facebook", "twitter", "github", "keybase", "links", "instagram", "publications"];
        var points = calcPointsCirc(object.X, object.Y, ((object.W+object.H)/6.8), ((object.W+object.H)/6.8)/(iconID.length*2));

        for (var x = 0; x < (iconID.length); x++) {
            X1 = points[x].x;
            Y1 = points[x].y;
            var image = new Image(); image.src = "images/"+iconID[x]+"A.svg";
            FOREGROUND.drawImage(image, (X1-(W/2)), (Y1-(H/2)), W, H);
           // X1 += W + globalSpace/2;


        }

    }

    });
}

//Report to console function set REPORT = true for debugging
function reportLog(text) {if (REPORT) {console.log(text);} return false;}

//whole number function to cleanup drawing
function w(x) {
    return x;
   // return Math.floor(x);
}

//Get points along a circle
function calcPointsCirc(cx, cy, rad, dashLength) {
    var n = rad/dashLength,
        alpha = Math.PI * 2 / n,
        pointObj = {},
        points = [],
        i = -1;

    while( i < n ) {
        var theta = alpha * i,
            theta2 = alpha * (i+1);

        points.push({x : (Math.cos(theta) * rad) + cx, y : (Math.sin(theta) * rad) + cy, ex : (Math.cos(theta2) * rad) + cx, ey : (Math.sin(theta2) * rad) + cy});
        i+=2;
    }

    return points;
}

//Update math
function update() {
    now = Date.now();
    delta = now - then;

    if (delta > interval) {

        displayObjects.forEach(function(object) {
            if (object.draggable) {
                if (PULSE >= 0) {
                    object.size += 0.005;
                } else if (PULSE < 0) {
                    object.size -= 0.005;
                }
            }

            /*/Hide background arrows once the center circle is dragged
            if (object.name === "background" && firstDrag) {
                if (object.alpha > 0) {
                    object.alpha -= 0.1;
                    if (object.alpha < 0) {object.alpha = 0;} //Sanity check
                }
            }*/
        });

        if (PULSE === 5) {PULSE = -7;}
        PULSE++;

        then = now - (delta % interval);
    }

    return false;
}

    //The main animation loop
    function mainLoop() {update(); draw(); requestAnimationFrame(mainLoop);}

</script>
