<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">

<!-- HEADER -->
<head>
	<!-- Set-up important tags + load css -->
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<title>Ben Geiling</title>
	<meta name="robots" content="index" />
	<meta name="author" content="Ben Geiling" />
	<link rel="stylesheet" type="text/css" href="main.css" media="screen" />

	<!-- Include JQuery -->
	<script type="text/javascript" src="scripts/jquery-2.1.4.min.js"></script>

	<!-- Include content resize script -->
	<script type="text/javascript" src="scripts/resize.js"></script>

	<!-- FOREGROUND -->
	<script>

        var stageForeground, FOREGROUND; //The foreground canvas
        var STARTUP = true; //Do different stuff when the page first loads
        var REPORT = false; //Debugging ON/OFF
        var OPACITY = 0.8; //Global oppacity value
        var DRAGGING = false; //Object being dragged (or not)
        var PULSE = 0;

        var displayObjects = new Array(); //All objects drawn to the scree
        var offsetX, offsetY; //The offset of the objects from the center when dragging

        //Animation loop stuff
        var fps = 30;
        var now;
        var then = Date.now();
        var interval = 1000/fps;
        var delta;




        function mouseMoveListener(evt) {
            //Get mouse position
            var bRect = stageForeground.getBoundingClientRect();
            var mouseX = (evt.clientX - bRect.left)*(stageForeground.width/bRect.width);
            var mouseY = (evt.clientY - bRect.top)*(stageForeground.height/bRect.height);

            DRAGGING.X = DRAGGING.Xori + (mouseX-offsetX);
            DRAGGING.Y = DRAGGING.Yori + (mouseY-offsetY);

            //Make sure it everything stays within the screen
            var radius = (DRAGGING.H + DRAGGING.W) / 4;

            if ((DRAGGING.X - radius) < 0) {DRAGGING.X = radius;}
            else if ((DRAGGING.X + radius) > BODY_WIDTH) {DRAGGING.X = BODY_WIDTH - radius;}

            if ((DRAGGING.Y - radius) < 0) {DRAGGING.Y = radius;}
            else if ((DRAGGING.Y + radius) > BODY_HEIGHT) {DRAGGING.Y = BODY_HEIGHT - radius;}

            //Check for collisions with other circles
            //UHH???

            draw();

            return false;
        }

        function mouseUpListener(evt) {
            stageForeground.addEventListener("mousedown", mouseDownListener, false);
            window.removeEventListener("mouseup", mouseUpListener, false);
            if (DRAGGING) {
                DRAGGING = false;
                stageForeground.removeEventListener("mousemove", mouseMoveListener, false);
            }
        }

        //When there is a mouse click
        function mouseDownListener(evt) {

            //Get mouse position
            var bRect = stageForeground.getBoundingClientRect();
            var mouseX = (evt.clientX - bRect.left)*(stageForeground.width/bRect.width);
            var mouseY = (evt.clientY - bRect.top)*(stageForeground.height/bRect.height);

            //Check if the mouse is in a circle (work backwards through array to maintain z-index)
            for (x = (displayObjects.length - 1); x >= 0; x--) {
                var object = displayObjects[x];
                var radiusSquared = Math.pow(((object.H + object.W) / 4), 2);
                var mouseSquared = Math.pow((mouseX - object.X), 2) + Math.pow((mouseY - object.Y), 2);

                //Check if mouse X/Y are inside of the circle
                if ((mouseSquared < radiusSquared) && object.draggable === true) {

                        offsetX = mouseX; offsetY = mouseY;
                        object.Xori = object.X; object.Yori = object.Y;

                        DRAGGING = object;
                        stageForeground.addEventListener("mousemove", mouseMoveListener, false);

                        stageForeground.removeEventListener("mousedown", mouseDownListener, false);
                        window.addEventListener("mouseup", mouseUpListener, false);

                        break;
                }

        }
            //code below prevents the mouse down from having an effect on the main browser window:
            if (evt.preventDefault) {
                evt.preventDefault();
            } //standard
            else if (evt.returnValue) {
                evt.returnValue = false;
            } //older IE

            return false;
        }



        //Called by resize.js when the page needs to be loaded
		function pageLoad() {

            //When the page first loads do different stuff, housekeeping mostly
            if (STARTUP) {
                //Setup the canvas variables
                stageForeground = document.getElementById('stageForeground');
                FOREGROUND = stageForeground.getContext('2d');

                //Preload images here!

                //Add a listener for mousedown
                stageForeground.addEventListener("mousedown", mouseDownListener, false);
                STARTUP = false;
            }



			//Create a min. relative stage size (looks better smaller on bigger screens)
			var MAX_SIZE = 500;
            var SCALE_FACTOR = 0.6; //Scale everything to be 80% min. size
            var stageW = MAX_SIZE; //Try to keep the size at max. size as long as possible

            if (MAX_SIZE >= SCALE) {
                stageW = SCALE;
            }

			//Set size of constant DIVs
            $("#stageForeground").prop('width', BODY_WIDTH)
            $("#stageForeground").prop('height', BODY_HEIGHT)

            //Setup containers for display
            displayObjects = []; //Empty display array

            var newObject = {
                X: Math.round((BODY_WIDTH/2)), //current X position
                Y: Math.round((BODY_HEIGHT/2)), //current Y position
                Xold: Math.round((BODY_WIDTH/2)), //last X position
                Yold: Math.round((BODY_HEIGHT/2)), //last Y position
                Xori: Math.round((BODY_WIDTH/2)), //original X position
                Yori: Math.round((BODY_HEIGHT/2)), //original Y position
                H: Math.round((SCALE*SCALE_FACTOR)), //Height
                W: Math.round((SCALE*SCALE_FACTOR)), //Width
                image: "images/circle0.svg", //image location
                draggable: false
            }; displayObjects.push(newObject);

            var newObject = {
                X: Math.round((BODY_WIDTH/2)), //current X position
                Y: Math.round((BODY_HEIGHT/2)), //current Y position
                Xold: Math.round((BODY_WIDTH/2)), //last X position
                Yold: Math.round((BODY_HEIGHT/2)), //last Y position
                Xori: Math.round((BODY_WIDTH/2)), //original X position
                Yori: Math.round((BODY_HEIGHT/2)), //original Y position
                H: Math.round((SCALE*SCALE_FACTOR)), //Height
                W: Math.round((SCALE*SCALE_FACTOR)), //Width
                image: "images/circle3.svg", //image location
                draggable: true
            }; displayObjects.push(newObject);

            var newObject = {
                X: Math.round((BODY_WIDTH/2)), //current X position
                Y: Math.round((BODY_HEIGHT/2)), //current Y position
                Xold: Math.round((BODY_WIDTH/2)), //last X position
                Yold: Math.round((BODY_HEIGHT/2)), //last Y position
                Xori: Math.round((BODY_WIDTH/2)), //original X position
                Yori: Math.round((BODY_HEIGHT/2)), //original Y position
                H: Math.round((SCALE*SCALE_FACTOR)), //Height
                W: Math.round((SCALE*SCALE_FACTOR)), //Width
                image: "images/circle2.svg", //image location
                draggable: true
            }; displayObjects.push(newObject);

            var newObject = {
                X: Math.round((BODY_WIDTH/2)), //current X position
                Y: Math.round((BODY_HEIGHT/2)), //current Y position
                Xold: Math.round((BODY_WIDTH/2)), //last X position
                Yold: Math.round((BODY_HEIGHT/2)), //last Y position
                Xori: Math.round((BODY_WIDTH/2)), //original X position
                Yori: Math.round((BODY_HEIGHT/2)), //original Y position
                H: Math.round((SCALE*SCALE_FACTOR)), //Height
                W: Math.round((SCALE*SCALE_FACTOR)), //Width
                image: "images/circle1.svg", //image location
                text: "images/textA.svg", //text location
                draggable: true
            }; displayObjects.push(newObject);

            // Start things off
            requestAnimationFrame(mainLoop);

			/*/Loop through each icon ID
				//Add Onclick function
				var onclickLocation;
				if (iconID[x] === "google") {
					onclickLocation = "https://www.plus.google.com/106269819982694676557/posts/p/pub";
				} else if (iconID[x] === "facebook") {
					onclickLocation = "https://www.facebook.com/ben.geiling";
				} else if (iconID[x] === "twitter") {
					onclickLocation = "https://www.twitter.com/BenGeiling";
				} else if (iconID[x] === "github") {
					onclickLocation = "https://www.github.com/BenGeiling";
				} else if (iconID[x] === "keybase") {
					onclickLocation = "https://www.keybase.io/bengeiling/";
				} else if (iconID[x] === "instagram") {
					onclickLocation = "https://www.instagram.com/bengeiling/";
				} else if (iconID[x] === "publications") {
					onclickLocation = "https://scholar.google.com/citations?user=1diKV9kAAAAJ&hl=en";
				} else if (iconID[x] === "links") {
					onclickLocation = "http://www.open-gmo.org/";
				}
			}*/
		}

/******************************************************************
*********************     Draw Everything     *********************
******************************************************************/
function draw() {
    var globalSpace = Math.ceil(SCALE/100);

    //Clear canvas first before drawing anything new
    FOREGROUND.clearRect(0, 0, BODY_WIDTH, BODY_HEIGHT);

    //Loop through all the objects that need to be drawn to the screen
    displayObjects.forEach(function(object) {
        reportLog(object); //Report object to log
        reportLog("X,Y,W,H - "+object.X+","+object.Y+","+object.W+","+object.H); //Report coords to log

        FOREGROUND.globalAlpha = OPACITY;

        //Draw the background circle from X/Y center point
        var img_circle = new Image(); img_circle.src = object.image;
        FOREGROUND.drawImage(img_circle, object.X-(object.W/2), object.Y-(object.H/2), object.W, object.H);

        //Update old values
        object.Xold = object.X;
        object.Yold = object.Y;

        FOREGROUND.globalAlpha = OPACITY*0.5;
if (object.text) {
        //Draw the middle circle from X/Y center point
        var img_circle = new Image(); img_circle.src = "images/link_text.svg";
        FOREGROUND.drawImage(img_circle, object.X-(object.W/6), object.Y-(object.H/6), object.W/3, object.H/3);
}
        var X1, X2, Y1, Y2, W, H;

        //Draw the text in the background
        if (object.text) {
            W = (object.W*0.7);
            H = W/2.54;
            X1 = object.X-((object.W*0.7)/2);
            X2 = object.X-((object.W*0.7)/2);
            Y1 = object.Y-(H/2)-(globalSpace*5);
            Y2 = object.Y-(H/2)-(globalSpace*5);

           // var image = new Image(); image.src = object.text;
            //FOREGROUND.drawImage(image, X1, Y1, W, H);
        }

        /*/Draw top line
        var lineWidth = Math.ceil(globalSpace/3);
        X1 = object.X-((object.W*0.7)/2);
        Y1 += H+(globalSpace*2)
        X2 += W;
        Y2 += H+(globalSpace*2);

        FOREGROUND.beginPath();
        FOREGROUND.moveTo(X1, Y1);
        FOREGROUND.lineTo(X2, Y2);
        FOREGROUND.lineWidth = lineWidth;
        FOREGROUND.strokeStyle = '#000000';
        FOREGROUND.stroke();
        FOREGROUND.closePath();*/

        //Draw icons
        var iconNumber = 8;
        H = (W/(iconNumber/2.5));
        W = (W/(iconNumber/2.5));
   //     Y1 += lineWidth + (globalSpace/2);
   //     Y2 += lineWidth + (globalSpace/2);

        var iconID = new Array();
		iconID = ["google", "facebook", "twitter", "github", "keybase", "links", "instagram", "publications"];
        var points = calcPointsCirc(object.X, object.Y, ((object.W+object.H)/6.8), ((object.W+object.H)/6.8)/(iconID.length*2));

        for (var x = 0; x < (iconID.length); x++) {
            X1 = points[x].x;
            Y1 = points[x].y;
            var image = new Image(); image.src = "images/"+iconID[x]+"A.svg";
            FOREGROUND.drawImage(image, (X1-(W/2)), (Y1-(H/2)), W, H);
           // X1 += W + globalSpace/2;


        }

        /*/Draw bottom line
        var lineWidth = Math.ceil(globalSpace/3);
        X1 = object.X-((object.W*0.7)/2);
        Y1 = 20+lineWidth+(globalSpace/2);
        X2 = X2;
        Y2 = 20+lineWidth+(globalSpace/2);

        FOREGROUND.beginPath();
        FOREGROUND.moveTo(X1, Y1);
        FOREGROUND.lineTo(X2, Y2);
        FOREGROUND.lineWidth = lineWidth;
        FOREGROUND.strokeStyle = '#000000';
        FOREGROUND.stroke();
        FOREGROUND.closePath();*/

        //Draw drag text
        W = (object.W*0.6);
        H = W/3;
        X1 = object.X-(W/2);
        Y1 = Y1+(globalSpace);

       // var image = new Image(); image.src = "images/drag.svg";
       // FOREGROUND.drawImage(image, X1, Y1, W, H);

    });
}

//Report to console function set REPORT = true for debugging
function reportLog(text) {
    if (REPORT) {console.log(text);}
    return false;
}

//Get points along a circle
function calcPointsCirc(cx, cy, rad, dashLength) {
    var n = rad/dashLength,
        alpha = Math.PI * 2 / n,
        pointObj = {},
        points = [],
        i = -1;

    while( i < n ) {
        var theta = alpha * i,
            theta2 = alpha * (i+1);

        points.push({x : (Math.cos(theta) * rad) + cx, y : (Math.sin(theta) * rad) + cy, ex : (Math.cos(theta2) * rad) + cx, ey : (Math.sin(theta2) * rad) + cy});
        i+=2;
    }

    return points;
}

//Update math
function update() {
    now = Date.now();
    delta = now - then;

    if (delta > interval) {

        displayObjects.forEach(function(object) {
            if (PULSE >= 0) {
                object.W++;
                object.H++;
            } else if (PULSE < 0) {
                object.W--;
                object.H--;
            }
        });

        if (PULSE === 5) {PULSE = -7;}
        PULSE++;

        then = now - (delta % interval);
    }

    return false;
}

//This is the main loop
function mainLoop() {
    update();
    draw();
    requestAnimationFrame(mainLoop);
}



</script>
</head>

<!-- BODY -->
<body>
    <?php include_once("analyticstracking.php") ?>
    <div id="preload"></div>
    <canvas id="stageForeground"></canvas>
	<div id="background">
        <div id="backer">

                <div id="text" onclick="window.location='mailto:ben@geiling.ca';" title="email me!"></div>

                <div class="line"></div>
                <div id="icons">
                    <div id="google" title="Google+"></div>
                    <div id="facebook" title="Facebook"></div>
                    <div id="twitter" title="Twitter"></div>
                    <div id="github" title="Github"></div>
                    <div id="keybase" title="Keybase"></div>
                    <div id="links" title="Links"></div>
                    <div id="instagram" title="Instagram"></div>
                    <div id="publications" title="Publications"></div>
                </div>
                <div class="line"></div>
            <div id="drag"></div>

        </div>
    </div>
</body>
